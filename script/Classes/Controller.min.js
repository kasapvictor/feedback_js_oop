class Controller{constructor(e){this.storage=new Storage,e.attachments.addEventListener("change",this.change.bind(this)),e.dropZone.addEventListener("dragenter",this.dragenter,!1),e.dropZone.addEventListener("dragover",this.dragover,!1),e.dropZone.addEventListener("drop",this.drop.bind(this),!1),e.form.addEventListener("click",this.delete.bind(this)),e.submit.addEventListener("click",this.submit.bind(this));for(let t in e.validate.require)if("warning"!==t){let e=document.querySelector(`label[for="${t}"]`),a=document.createElement("span");a.classList.add("valid-warning"),e.append(" *"),e.append(a)}for(let t in e.validate.require)if("warning"!==t){document.querySelector("#"+t).addEventListener("blur",this.validate)}}change(e){this.storage.checkSize(e.target.files)&&this.addFiles(e.target.files)}dragenter(e){e.stopPropagation(),e.preventDefault()}dragover(e){e.stopPropagation(),e.preventDefault()}drop(e){e.stopPropagation(),e.preventDefault();let t=e.dataTransfer.files;this.storage.checkSize(t)&&this.addFiles(t)}delete(e){if(e.target.hasAttribute(data.deleteFile)){e.preventDefault();let t=e.target.getAttribute(data.deleteFile);for(let e=0;e<Object.keys(data.uploadsFiles).length;e++)data.uploadsFiles[e].name===t&&(data.uploadsFiles.splice(e,1),data.count--);Object.keys(data.uploadsFiles<data.limitSize)&&(data.fileInput.style.display="flex",data.dropZone.style.display="flex"),document.querySelector(`[data-prev-file-name="${t}"]`).remove(),View.showFileInfo(this.storage.getFilesInfo(data.uploadsFiles),data.outFilesInfo)}}addFiles(e){this.storage.checkFiles(e,data.limitCount),View.renderFiles(e)}checkEmpty(e){let t=1,a="";for(let i=0;i<e.length;i++){let r=e[i],n=e[i].getAttribute("id"),l=e[i].value.trim(),d=r.previousElementSibling.querySelector(".valid-warning");data.validate.require[n]&&""===l&&(a=data.validate.require.warning,View.warning(r,d,a),t=0)}return t}validate(e){let t,a,i=e.target,r=e.target.getAttribute("id"),n=e.target.value.trim(),l=e.target.previousElementSibling.querySelector(".valid-warning");if(data.validate.require[r]&&""===n)return t=data.validate.require.warning,View.warning(i,l,t),void(a=0);if(View.warningReset(i,l),a=1,void 0!==data.validate.length[r]){if(data.validate.length[r].min>n.length)return t=`${data.validate.length.warning.min} ${data.validate.length[r].min}`,View.warning(i,l,t),void(a=0);if(data.validate.length[r].max<n.length)return t=`${data.validate.length.warning.max} ${data.validate.length[r].max}`,View.warning(i,l,t),void(a=0)}if("email"===r){if(0==/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(n))return t="Введите корректный e-mail",View.warning(i,l,t),void(a=0)}return a}submit(e){if(e.preventDefault(),this.checkEmpty(data.form.elements)){let e=new FormData,t=[];for(let e=0;e<data.form.elements.length;e++)"submit"!==data.form.elements[e].name&&"file"!==data.form.elements[e].type&&""!==data.form.elements[e].value&&(t[data.form.elements[e].name]=data.form.elements[e].value);if(0!==Object.keys(t).length){for(let a in t)e.append(a,t[a]);if(0!==data.uploadsFiles.length)for(let t in data.uploadsFiles)e.append(t,data.uploadsFiles[t].file,data.uploadsFiles[t].name);!function(e){fetch(data.url,{method:"POST",body:e}).then(e=>e.text()).then(e=>{console.log(e)}).catch(e=>{console.error(e)})}(e),View.reset()}}}}